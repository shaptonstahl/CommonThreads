{
    "contents" : "#' Which variables best explain membership?\n#'\n#' Identify which variables explain best why these observations/nodes\n#' are distinct from those observations.\n#' \n#' @param X data.frame of observations\n#' @param members numeric vector of rows included or logical vector with TRUE for members\n#' @param min.nonzero.certainty numeric p-value must be below 1-min.nonzero.certainty to report result for a coefficient\n#' @return data.frame with variables column.name, effect, prob.not.zero\n#' @export\n#' @seealso Use the output to describe the relationships in plain text with \\code{\\link{CommonThreadDescriptions}}.\n#' @author Stephen R. Haptonstahl \\email{srh@@haptonstahl.org}\n#' @examples\n#' data(iris)\n#' observations.selected <- sample(1:nrow(iris), 30)\n#' CommonThreads(X=iris, members=observations.selected)\n#' CommonThreads(X=iris, members=observations.selected, min.nonzero.certainty=.5)\nCommonThreads <- function(X,\n                          members,\n                          min.nonzero.certainty=.75) {\n  # Guardians\n  stopifnot(is(X, \"data.frame\") && nrow(X) >= 2,\n            (is(members, \"logical\") && length(members) == nrow(X)) || \n              (is(members, \"numeric\") && is.subset(members, 1:nrow(X))),\n            min.nonzero.certainty > 0 && min.nonzero.certainty < 1\n  )\n  \n  ###  deal with default and missing values  ###\n  \n  # Will work with Z internally\n  Z <- dummy.data.frame(X, sep=\".\")  # package::dummies; NOT SURE ABOUT THIS STEP\n  Z <- scale(Z)   # makes each column mean=0, stdev=1\n  \n  # code dependent variable, taking out repeated elements\n  dep.var.name <- paste(\"cty\", paste(sample(letters, 10), collapse=\"\"), sep=\".\")  # random name to avoid colision\n  if( is(members, \"logical\") ) members <- which(members)\n  members <- unique(members)  # remove duplicate indices\n  dep.var <- rep(0, nrow(X))\n  dep.var[members] <- 1\n  Z <- data.frame(dep.var, Z)\n  names(Z)[1] <- dep.var.name\n  \n  # perform the function\n  probit.res <- glm(formula(paste(dep.var.name, \"~ .\")), \n                    data=Z, \n                    family=binomial(link=\"probit\"))\n  \n  # prepare and return the output\n  out <- summary(probit.res)$coefficients[-1,]\n  out <- out[sort(abs(out[,1]), decreasing=TRUE, index.return=TRUE)$ix,]  # sort by absolute value of coefficient\n  out <- out[out[,4] < 1 - min.nonzero.certainty,]\n  out <- data.frame(rownames(out), out)\n  names(out) <- c(\"column.name\", \"effect\", \"std.err\", \"z.value\", \"p.value\")\n  out$prob.not.zero <- 1 - out$p.value\n  out <- out[,c(\"column.name\", \"effect\", \"prob.not.zero\")]\n  rownames(out) <- NULL\n  \n  out <- list(threads=out, \n              X=X,\n              members=members,\n              min.nonzero.certainty=min.nonzero.certainty)\n  \n  return(out)\n}\n",
    "created" : 1392594487698.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2389870481",
    "id" : "ADFCAB13",
    "lastKnownWriteTime" : 1392595033,
    "path" : "~/GitHub/CommonThreads/Rproject/dev/CommonThreads/R/CommonThreads.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}